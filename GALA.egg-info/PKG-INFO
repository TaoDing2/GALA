Metadata-Version: 2.4
Name: GALA
Version: 0.1.0
Summary: A package for spatial transcriptomics alignment with GALA
Author-email: Tao Ding <dingtao@shanghaitech.edu.cn>
License: MIT
Project-URL: Homepage, https://github.com/TaoDING2/GALA
Requires-Python: >=3.8
Description-Content-Type: text/markdown
Requires-Dist: anndata==0.11.4
Requires-Dist: hnswlib==0.8.0
Requires-Dist: matplotlib==3.10.1
Requires-Dist: networkx==3.4.2
Requires-Dist: numpy==2.1.3
Requires-Dist: opencv-python==4.11.0.86
Requires-Dist: pandas==2.2.3
Requires-Dist: pygad==3.4.0
Requires-Dist: scanpy==1.11.0
Requires-Dist: scikit-learn==1.5.2
Requires-Dist: scipy==1.15.2
Requires-Dist: seaborn==0.13.2
Requires-Dist: squidpy==1.6.5
Requires-Dist: torch==2.6.0

# GALA
A Unified Landmark-Free Framework for Coarse-to-Fine Spatial Alignment Across Resolutions and Modalities in Spatial Transcriptomics
=======



# Pipeline of GALA and its application scenarios
![Pipeline of GALA and its application scenarios](./overview.jpg)

-  **(a)** GALA takes as input a ***source*** dataset (to be aligned) and a ***target*** dataset, both multimodal and integrating spatial coordinates (`coords`), gene expression (`expr`), and histological images (`histo`). They differ in resolution: the source is at cellular/subcellular (cell-level) and the target at multicellular (spot-level) resolution. To enable joint processing, both datasets are rasterized into multi-channel tensors, $I \in \mathbb{R}^{c \times H_1 \times W_1}$ and $J \in \mathbb{R}^{c \times H_2 \times W_2}$, with $c = p + 2$ determined by input modalities.  The Coupled alignment process summarises the global affine transformation $A$ and jointly estimates the local diffeomorphic mapping $\phi^v$ with the probabilistic matching $P_M$, producing the final aligned output through iterative coupled optimisation.  The alignment of a representative informative gene is also shown. 

- **(b)** Detailed schematic of the coupled alignment process, including the unified objective function and optimisation scheme, with convergence illustration. The objective function comprises fidelity terms for transcriptomics and histology (with fusion weight $\alpha$) and a regularisation term penalising the diffeomorphic mapping $\phi^v$. The global stage estimates the affine matrix $A$ via a GA, corresponding to a linear transformation. The local stage jointly refines the diffeomorphic deformation $\phi^v$ and probabilistic matching $P_M$ through an EM-like LDDMM procedure, representing a nonlinear transformation guided by a Gaussian posterior with prior probability $\pi_M$ and variance $\sigma_M^2$. Convergence of fidelity and regularisation across global-local iterations is also illustrated.

- **(c)** GALA applies broadly across diverse alignment tasks, including same-modality alignment at matched or mismatched resolutions (spot-to-spot, cell-to-cell, or cell-to-spot/spot-to-cell) and cross-modality alignment (e.g., transcriptomics-to-histology at different scales). It also supports both full and partial alignment.

# Tutorials
- Spot-to-spot alignment of DLPFC data. (See [tutorial1](tutorials/tutorial1.ipynb))
- Spot-to-spot alignment of DLPFC data (partial alignment). (See [tutorial3](tutorials/tutorial2.ipynb))
- Spot-to-spot alignment of MBSP data. (See [tutorial3](tutorials/tutorial3.ipynb))
- Cell-to-cell alignment of mouse liver replicates. (See [tutorial4](tutorials/tutorial4.ipynb))
- Cell-to-spot alignment of mouse brain coronal sections (partial alignment). (See [tutorial5](tutorials/tutorial5.ipynb))
- Transcriptomics-to-Histology alignment of human breast and lung cancers (partial alignment). (See [tutorial6](tutorials/tutorial6.ipynb))



# Installation
Users need to create an environment and install GALA by following procedures:
```
conda create -n gala_env python=3.12.9
conda activate gala_env

```

